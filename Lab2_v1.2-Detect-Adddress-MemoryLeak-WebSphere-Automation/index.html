<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Lab2 v1.2 Detect Adddress MemoryLeak WebSphere Automation - IBM WebSphere Automation Lab</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  <link href="../extra.css" rel="stylesheet">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Lab2 v1.2 Detect Adddress MemoryLeak WebSphere Automation";
    var mkdocs_page_input_path = "Lab2_v1.2-Detect-Adddress-MemoryLeak-WebSphere-Automation.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> IBM WebSphere Automation Lab</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="..">Hand-on Lab</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">IBM WebSphere Automation Lab</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Lab2 v1.2 Detect Adddress MemoryLeak WebSphere Automation</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <p><span id="_Toc107577959" class="anchor"></span><strong>Detect and Address
Application Memory Leak with IBM WebSphere Automation</strong></p>
<p><img alt="banner" src="../images/media/image1.jpeg" /></p>
<p><strong>Last updated:</strong> March 2022</p>
<p><strong>Duration:</strong> 45 mins</p>
<p>Need support? Contact <strong>Yi Tang</strong> and <strong>Kevin Postreich</strong></p>
<h1 id="contents">Contents</h1>
<p><a href="#_Toc107577959"><strong>Detect and Address Application Memory Leak with IBM WebSphere
Automation</strong> 1</a></p>
<p><a href="#_Toc107577960"><strong>Introduction to WebSphere Automation</strong> 3</a></p>
<p><a href="#_Toc107577961"><strong>Business Context</strong> 4</a></p>
<p><a href="#_Toc107577962"><strong>Accessing and starting the environment</strong> 6</a></p>
<p><a href="#part-1-register-wasliberty-servers-with-wsa"><strong>Part 1: Register WAS/Liberty Servers with WSA</strong>
9</a></p>
<p><a href="#part-2-installing-and-starting-instana-agent"><strong>Part 2: Installing and starting Instana agent</strong>
16</a></p>
<p><a href="#part-3-configure-websphere-automation-integration-with-instana-and-websphereliberty-servers"><strong>Part 3: Configure WebSphere Automation integration with Instana and
WebSphere/Liberty Servers</strong>
21</a></p>
<p><a href="#part-4-configure-instana-for-memory-leak-alert"><strong>Part 4: Configure Instana for memory leak alert</strong>
26</a></p>
<p><a href="#part-5-websphere-memory-leak-check-with-websphere-automation"><strong>Part 5: WebSphere memory leak check with WebSphere Automation</strong>
39</a></p>
<p><a href="#part-6-liberty-memory-leak-check-with-websphere-automation"><strong>Part 6: Liberty memory leak check with WebSphere Automation</strong>
48</a></p>
<p><a href="#_Toc107577969"><strong>Summary</strong> 52</a></p>
<p><a href="#appendix-1-reserve-an-environment-for-the-lab"><strong>Appendix 1: Reserve an environment for the lab</strong>
54</a></p>
<p><a href="#the-lab-environment"><strong>The lab environment</strong> 57</a></p>
<p><span id="_Toc107577960" class="anchor"></span><strong>Introduction to
WebSphere Automation</strong></p>
<p><a href="https://www.ibm.com/cloud/websphere-automation"><span class="underline">IBM WebSphere
Automation</span></a> (WSA)
is focused on delivering value into existing WebSphere Application
Server (WAS) environments, helping administrators reduce the cost,
effort, and risk of addressing common vulnerabilities, automating tasks,
and remediating capacity incidents.</p>
<p>It removes manual toil so that your team can spend more time innovating
while minimizing the cost of extending the life and maximizing the ROI
of your WebSphere investments.</p>
<p>In conversations with customers, the same three concerns come up
repeatedly. Organizations need to keep their IT estate secure and
compliant, resilient to disruption and running optimally while reducing
costs and maximizing ROI.</p>
<p>WSA helps organizations gain visibility, operational efficiencies, and
cost savings quickly by extending the life of WebSphere investments and
giving teams time back to focus on unlocking new value and fixing the
imbalance of pure maintenance versus innovation tasks.</p>
<ul>
<li>
<p>WebSphere operators and administrators save time and embrace
    DevSecOps by implementing patches more efficiently on virtual and
    container environments to keep operations compliant and secure.</p>
</li>
<li>
<p>Enhance remediation capabilities with insights and recommendations
    to improve the speed and depth of understanding of outages and
    anomalies as they occur.</p>
</li>
<li>
<p>Augment the operational experience with access to simplified and
    consolidated information that enables teams to act.</p>
</li>
</ul>
<p>With WSA, security, business efficiency and resiliency become standard.
IBM can meet you wherever you are in your optimization and automation
journeys to help you quickly deliver value and increase ROI, all while
laying a solid automation foundation to support future growth.</p>
<p>IBM WSA is available as a stand-alone offering or as an addition to IBM
Cloud Pak® for Watson AIOps. As part of IBM Automation platform, IBM
WebSphere Automation includes containerized components and common
software services on top of a common automation layer, to manage
WebSphere’s incidents, hybrid applications, and cost with complete
observability, governance, and compliance.</p>
<p>Deploy virtually anywhere through containers supported by Red Hat®
OpenShift® software, on IBM Cloud®, on essentially any existing
infrastructure on-premises, or through private and public clouds. Use
only the capabilities you need with a fully modular approach that’s
designed to be easy to consume.</p>
<p>One of the WSA capabilities is automating memory leak detection and
analysis in order to speed time to corrective action. With WSA,
operation teams no longer need to gather problem diagnostic information
manually or analyze heap dumps. WSA handles that for you and provides an
analysis report that can be shared with the application development team
or app vendor.</p>
<p><span id="_Toc107577961" class="anchor"></span><strong>Business Context</strong></p>
<p>You are a WebSphere Administrator, part of a WebSphere Operations Team
responsible for maintaining health of the WebSphere estate in the
enterprise. A typical “as-is” process for maintaining health for
WebSphere environments is depicted below.</p>
<p><strong>Today (as-is):</strong></p>
<ol>
<li>
<p>Manually monitor the application memory usage and take actions when
    seeing the heap usage keeping increasing.</p>
</li>
<li>
<p>Manually capture heap dumps</p>
</li>
<li>
<p>Go through heap dumps and try to find the root cause of the memory
    leak.</p>
</li>
</ol>
<p>Currently, this is a very manual, time-consuming process, and you'd like
to automate this process to direct valuable time and resource elsewhere.
This is where <strong>IBM WebSphere Automation will help!</strong></p>
<p>You would like to have:</p>
<ul>
<li>
<p><strong>Management dashboard:</strong> Consolidated dashboard increases awareness
    and response time to the health of your WebSphere and Liberty
    servers</p>
</li>
<li>
<p><strong>Automated problem investigation:</strong> Let WebSphere Automation track
    new health issue across your existing traditional WebSphere and
    Liberty environments, on virtual machines or containers.</p>
</li>
<li>
<p><strong>Contextual notifications:</strong> Receive health bulletin notifications
    only when new health issue affect the environment you manage,
    reducing noise and interruptions to the WebSphere operations team.</p>
</li>
<li>
<p><strong>Shared, live visibility to key stakeholders:</strong> WebSphere operators
    and development teams can see the real-time health posture of the
    WebSphere estate, accelerating action and minimizing the risk of
    miscommunication.</p>
</li>
</ul>
<p>In this lab, you are going to use a traditional WebSphere Application
Server and a Liberty Server registered with WSA and monitored by Instana
to drive a memory leak investigation.</p>
<p><img alt="Diagram Description automatically
generated" src="../images/media/image2.png" /></p>
<p>You are going to use a sample application and a script which is going to
continuously add objects to the heap to create a memory leak event.
Instana will detect such event and will initiate a communication with
WSA to inform that a leak has been detected. Once that is done, WSA will
open an investigation and begin gathering the necessary problem
diagnostic information for that server. You can see the investigation is
opened and the process which it goes through. These processes include:</p>
<ul>
<li>
<p>Memory leak detected</p>
</li>
<li>
<p>Identifying server</p>
</li>
<li>
<p>Collecting heap dump</p>
</li>
<li>
<p>Analyzing heap dump</p>
</li>
<li>
<p>Investigation complete</p>
</li>
</ul>
<p>In the end of the investigation, WSA provides an analysis summary which
indicates the likely potential root cause of the memory leak. In this
case it is a vector inside the sample application which is being hosted
by the servlet wrapper. WSA also allow you to simply download all the
files that you need with your application development team or
application vendor so that they could take the action to fix the
application.</p>
<p>At the end of this lab, you will learn how WSA can automatically:</p>
<ul>
<li>
<p>detect memory leaks before they cause a crash</p>
</li>
<li>
<p>gather problem determination (PD) information while the leak is in
    progress</p>
</li>
<li>
<p>analyze the PD info and produce a report which can be exported and
    share with app development teams or app vendors</p>
</li>
</ul>
<p><span id="_Toc107577962" class="anchor"></span><strong>Accessing and starting
the environment</strong></p>
<p>If you are doing this lab as part of an instructor led workshop (virtual
or face to face), an environment has already been provisioned for you.
The instructor will provide the details for accessing the lab
environment.</p>
<p>Otherwise, you will need to reserve an environment for the lab. You can
obtain one here. Follow the on-screen instructions for the “<strong>Reserve
now</strong>” option.</p>
<blockquote>
<p><a href="https://techzone.ibm.com/my/reservations/create/60da2c20e2cb7a001f656575">https://techzone.ibm.com/my/reservations/create/60da2c20e2cb7a001f656575</a></p>
</blockquote>
<table>
<tbody>
<tr class="odd">
<td><img src="./images/media/image3.png" style="width:0.60417in;height:0.60417in" alt="sign-info" /></td>
<td><p><strong>TIP:</strong></p>
<p>If you need additional details, the step-by-step instructions for reserving an environment can be found in <strong>APPENDIX 1</strong> of this lab guide.</p></td>
</tr>
</tbody>
</table>

<ol>
<li>
<blockquote>
<p>When the demo environment is provisioned, use the provided
    &gt; username and password to access and start the environment. You
    &gt; should see the following screen:</p>
</blockquote>
</li>
</ol>
<blockquote>
<p><img alt="Graphical user interface, application Description automatically
generated" src="../images/media/image4.png" /></p>
</blockquote>
<p>WebSphere Automation is pre-installed in the OCP cluster hosted on the
VMs.</p>
<ol>
<li>
<blockquote>
<p>If the environment is <strong>NOT</strong> already started, go ahead, and
    &gt; <strong>Start</strong> the environment by clicking on the <strong>Play</strong> button. It
    &gt; takes about 10-15 minutes for the environment to start and
    &gt; stabilize.</p>
</blockquote>
</li>
</ol>
<blockquote>
<p><img alt="" src="../images/media/image5.png" /></p>
<p>You will be working on the <strong>STUDENT</strong> VM only.</p>
<p>All the WebSphere images required for the lab are pre-installed:</p>
</blockquote>
<ul>
<li>
<p>/opt/IBM/WebSphere/Liberty200012/</p>
</li>
<li>
<p>/opt/IBM/WebSphere/AppServer9056/</p>
</li>
</ul>
<!-- end list -->

<ol>
<li>
<blockquote>
<p>Click the screen representing the <strong>STUDENT</strong> VM</p>
</blockquote>
</li>
</ol>
<blockquote>
<p><img alt="student vm" src="../images/media/image6.png" /></p>
</blockquote>
<ol>
<li>
<blockquote>
<p>Once you log in to the Student VM you will see the Desktop, which
    &gt; contains all the programs that you will be using (browsers,
    &gt; terminal, etc.)</p>
</blockquote>
</li>
</ol>
<blockquote>
<p>The login credentials for the <strong>STUDENT</strong> image is:</p>
<p>User ID: <strong>ibmuser</strong></p>
<p>Password: <strong>engageibm!</strong></p>
<p><img alt="student vm screen" src="../images/media/image7.png" /></p>
</blockquote>
<ol>
<li>
<blockquote>
<p>You can resize the virtual desktop with the <strong>Fit to window</strong>
    &gt; button, located at the top of the Skytap environment window.</p>
</blockquote>
</li>
</ol>
<blockquote>
<p><img alt="fit to window" src="../images/media/image8.png" /></p>
</blockquote>
<p><strong><br />
</strong></p>
<h1 id="part-1-register-wasliberty-servers-with-wsa"><strong>Part 1: Register WAS/Liberty Servers with WSA</strong></h1>
<p>To use the WSA for health check of WAS and Liberty servers, WAS and
Liberty servers need to be registered with WSA first. The detail WSA
registration process is can be find in <strong>Lab1 - Strengthen Operational
Security with IBM WebSphere Automation</strong> documentation. In this lab, you
are going to use a script to register the WAS server and the Liberty
server with WSA.</p>
<ol>
<li>Double-click Firefox icon to launch the web browser</li>
</ol>
<blockquote>
<p><img alt="Graphical user interface Description automatically
generated" src="../images/media/image9.png" /></p>
</blockquote>
<ol>
<li>Click WebSphere Automation bookmark</li>
</ol>
<blockquote>
<p><img alt="Graphical user interface, text, application Description
automatically generated" src="../images/media/image10.png" /></p>
</blockquote>
<ol>
<li>Click OpenShift authentication</li>
</ol>
<p><img alt="Graphical user interface, text, application Description automatically
generated" src="../images/media/image11.png" /></p>
<ol>
<li>Click <strong>htpasswd.</strong></li>
</ol>
<p><img alt="Graphical user interface, application Description automatically
generated" src="../images/media/image12.png" /></p>
<ol>
<li>Enter Username and Password as: <strong>ibmadmin</strong>/e<strong>ngageibm</strong> and click
    <strong>Log in</strong>.</li>
</ol>
<p><img alt="Graphical user interface, application Description automatically
generated" src="../images/media/image13.png" /></p>
<ol>
<li>Click <strong>menu</strong> icon and select <strong>Application runtimes</strong>.</li>
</ol>
<blockquote>
<p><img alt="Graphical user interface, text, application Description
automatically generated" src="../images/media/image14.png" /></p>
</blockquote>
<p><img alt="Graphical user interface, application Description automatically
generated" src="../images/media/image15.png" /></p>
<blockquote>
<p>The WSA Security page is displayed, and the server registration list
is empty.</p>
</blockquote>
<p><img alt="Graphical user interface, application, Teams Description automatically
generated" src="../images/media/image16.png" /></p>
<ol>
<li>Open a Terminal window, by clicking <strong>Applications</strong> >
    <strong>Terminal</strong>.</li>
</ol>
<blockquote>
<p><img alt="Graphical user interface, application Description automatically
generated" src="../images/media/image17.png" /></p>
</blockquote>
<ol>
<li>If you have not cloned the public repo named
    <strong>WAS-Automation-LabFiles</strong> to your lab environment before, now it
    is timer to do it, otherwise you can skip this step. In the Terminal
    window, clone the Git repository used for this lab with the
    following command:</li>
</ol>
<blockquote>
<p>cd /home/ibmuser</p>
<p>git clone https://github.com/IBMTechSales/WAS-Automation-LabFiles.git</p>
<p>These commands above clone the public repo named
<strong>WAS-Automation-LabFiles</strong> to the local directory under
/<strong>home/ibmuser/WAS-Automation-LabFiles</strong> directory.</p>
</blockquote>
<ol>
<li>Run script <strong>register_was_liberty</strong> in the
    <strong>WAS-Automation-LabFiles/ lab2-MemoryLeak</strong> directory to register
    WAS server and Liberty server to WSA.</li>
</ol>
<blockquote>
<p>chmod +x /home/ibmuser/WAS-Automation-LabFiles/lab2-MemoryLeak/*.sh</p>
<p>/home/ibmuser/WAS-Automation-LabFiles/lab2-MemoryLeak/register_was_liberty.sh</p>
</blockquote>
<ol>
<li>Once the script execution is completed, go back to the WSA page and
    you can see that the WAS server and Liberty server are registered
    with WSA.</li>
</ol>
<blockquote>
<p><img alt="Graphical user interface, application Description automatically
generated" src="../images/media/image18.png" /></p>
<p>The WAS and Liberty registration is now completed.</p>
</blockquote>
<ol>
<li>
<p>Next, you need to configure an email to received notifications from
    WSA. The Email server configuration is pre-configured for this lab.
    You only need to add your personal email to receive WSA
    notifications.</p>
<ol>
<li>Select the <strong>Notifications</strong> menu item from the navigation list
    and click on the <strong>Email addresses</strong> tab, to add your email
    address where WSA notifications will be delivered.</li>
</ol>
</li>
</ol>
<blockquote>
<p><img alt="Graphical user interface, application, Teams Description
automatically generated" src="../images/media/image19.png" /></p>
</blockquote>
<ol>
<li>Click the <strong>Add</strong> button, enter your <strong>email address</strong> and click
    <strong>Save</strong>.</li>
</ol>
<blockquote>
<p><img alt="Graphical user interface, application, Teams Description
automatically generated" src="../images/media/image20.png" /></p>
<p>Great! Your email is configured to receive WSA notifications.</p>
</blockquote>
<p><strong><br />
</strong></p>
<h1 id="part-2-installing-and-starting-instana-agent"><strong>Part 2: Installing and starting Instana agent</strong></h1>
<p>In this section, you install an Instana agent to the <strong>STUDENT</strong>
workstation and start it.</p>
<ol>
<li>From the web browser, open a new window and click the Instana
    bookmark to access Instana page.</li>
</ol>
<blockquote>
<p><img alt="Graphical user interface, application, Word Description
automatically generated" src="../images/media/image21.png" /></p>
<p>Using the login credentials as:</p>
<p>E-Mail: <strong>admin@instana.local</strong></p>
<p>Password: <strong>qJgN6hS6sE</strong></p>
</blockquote>
<ol>
<li>In the Installing Instana Agent page is displayed. Select <strong>Linux</strong>
    OS, <strong>Dynamic</strong> Agent mode, <strong>Eclipse OpenJ9 11</strong> Agent runtime, and
    <strong>Interactive</strong> Installation mode and click <strong>Copy</strong> to copy the
    scrip for installing the Instana agent.</li>
</ol>
<blockquote>
<p><img alt="Graphical user interface, application Description automatically
generated" src="../images/media/image22.png" /></p>
</blockquote>
<ol>
<li>Go back to the Terminal window, right-click and select <strong>Paste</strong> to
    paste the Intana agent installation script.</li>
</ol>
<blockquote>
<p><img alt="Graphical user interface, website Description automatically
generated" src="../images/media/image23.png" /></p>
</blockquote>
<ol>
<li>Press <strong>Enter</strong>, type the sudo password as: <strong>engageibm!</strong> and
    press <strong>Enter</strong> again to start the agent installation.</li>
</ol>
<blockquote>
<p>The output looks like this:</p>
</blockquote>
<table>
<tbody>
<tr class="odd">
<td><blockquote>
<p>[ibmuser@student ~]$ #!/bin/bash</p>
<p>[ibmuser@student ~]$</p>
<p>[ibmuser@student ~]$ curl -o setup_agent.sh https://setup.instana.io/agent &amp;&amp; chmod 700 ./setup_agent.sh &amp;&amp; sudo ./setup_agent.sh -a qUMhYJxjSv6uZh2SyqTEnw -t dynamic -e techsales.demos.net:1444 -j</p>
<p>% Total % Received % Xferd Average Speed Time Time Time Current</p>
<p>Dload Upload Total Spent Left Speed</p>
<p>100 20470 100 20470 0 0 28156 0 --:--:-- --:--:-- --:--:-- 28156</p>
<p>[sudo] password for ibmuser:</p>
<p>Setting up the dynamic-j9 Instana agent for GNU/Linux</p>
<p>Are you sure? [y/N] y</p>
<p>Setting up Instana RPM repository</p>
<p>Updating YUM metadata</p>
<p>Installing Instana agent</p>
<p>warning: /var/cache/dnf/instana-agent-91ace26a4f2bcbd6/packages/instana-agent-dynamic-j9-20220307-0948.x86_64.rpm: Header V4 RSA/SHA256 Signature, key ID 9bad82de: NOKEY</p>
<p>Importing GPG key 0x9BAD82DE:</p>
<p>Userid : "stan@instana.com &lt;stan@instana.com&gt;"</p>
<p>Fingerprint: B878 152E 2F08 4D46 F878 FA20 BED2 D096 9BAD 82DE</p>
<p>From : https://packages.instana.io/Instana.gpg</p>
</blockquote></td>
</tr>
</tbody>
</table>

<blockquote>
<p>Instana agent is installed in <strong>/opt/instana/agent</strong> directory.</p>
</blockquote>
<ol>
<li>
<p>Define Instana Infrastructure Zone</p>
<ol>
<li>Open the Instana agent configuration file for editing with the
    command</li>
</ol>
</li>
</ol>
<blockquote>
<p>sudo gedit /opt/instana/agent/etc/instana/configuration.yaml</p>
</blockquote>
<ol>
<li>Change the Hardware and Zone section as the follows</li>
</ol>
<table>
<tbody>
<tr class="odd">
<td><p># Hardware &amp; Zone</p>
<p>com.instana.plugin.generic.hardware:</p>
<p>enabled: true # disabled by default</p>
<p>availability-zone: 'WebSphere'</p></td>
</tr>
</tbody>
</table>

<blockquote>
<p>After the changes are made, your file contents should look this</p>
<p><img alt="Graphical user interface, text Description automatically
generated" src="../images/media/image24.png" /></p>
</blockquote>
<ol>
<li>Click <strong>Save</strong> to save the changes, then click <strong>Close</strong> to close
    the editor.</li>
</ol>
<blockquote>
<p><img alt="Graphical user interface, text, application Description
automatically generated" src="../images/media/image25.png" /></p>
</blockquote>
<ol>
<li>Start Instana agent with the command:</li>
</ol>
<blockquote>
<p>sudo systemctl start instana-agent.service</p>
<p>If prompted, enter the sudo password as: <strong>engageibm!</strong></p>
<p>Instana agent is now started.</p>
</blockquote>
<ol>
<li>Verify the Instana agent installation</li>
</ol>
<blockquote>
<p>Note: after the agent is started, it might take a few minutes for the
agent to sync with Instana server.</p>
</blockquote>
<ol>
<li>Go back to the Instana page in web browser, scroll to the bottom of
    the page and click <strong>Go to Instana!</strong> to navigate to Instana
    administrative console page.</li>
</ol>
<p><img alt="Rectangle Description automatically generated with medium
confidence" src="../images/media/image26.png" /></p>
<ol>
<li>In the Instana administrative console page, click the
    <strong>Infrastructure</strong> icon.</li>
</ol>
<p><img alt="Graphical user interface, application Description automatically
generated" src="../images/media/image27.png" /></p>
<ol>
<li>Click Time Rage dropdown button, select <strong>Last 5 minutes</strong> and click
    <strong>Live</strong>.</li>
</ol>
<p><img alt="A screenshot of a computer Description automatically generated with
medium confidence" src="../images/media/image28.png" /></p>
<blockquote>
<p>After a few minutes, you see that the infrastructure zone you defined
is displayed.</p>
<p><img alt="A picture containing shape Description automatically
generated" src="../images/media/image29.png" /></p>
<p>The Istana agent is now set to monitor the changes in 5 minutes
interval, the agent installation is now completed.</p>
</blockquote>
<h1 id="part-3-configure-websphere-automation-integration-with-instana-and-websphereliberty-servers"><strong>Part 3: Configure WebSphere Automation integration with Instana and WebSphere/Liberty Servers</strong></h1>
<p>WSA is communicating with Instana to receive real-time Instana alerts.
WSA also to access the VMs where registered WebSphere and Liberty
servers are hosted to collect problem diagnostic information. The
following steps walk you through the integration process.</p>
<ol>
<li>Import the WSA certificate into Instana</li>
</ol>
<blockquote>
<p>In this part, you create a keystore with the WSA certificate and
add it to Instana. This is done by using any current keystore (in the
lab you are using the <strong>cacerts</strong> keystore), import the WSA
certificate, then copy the keystore to the Instana server and add the
keystore to the Instana configuration.</p>
<p>a. From the Terminal, make copy a current cacerts with the command:</p>
<p>cp /opt/instana/agent/jvm/lib/security/cacerts .</p>
<p>b. Retrieve WebSphere Automation certificate with the command:</p>
<p>echo | openssl s_client -showcerts -servername
cpd-websphere-automation.apps.demo.ibmdte.net -connect
cpd-websphere-automation.apps.demo.ibmdte.net:443 2>/dev/null |
openssl x509 -inform pem > cpd.pem</p>
<p>c. Import the certificate to the keystore file with the command:</p>
<p>keytool -importcert -file cpd.pem -alias ibm.com -keystore cacerts
-storepass changeit -noprompt</p>
<p>The output is showing like this:</p>
</blockquote>
<table>
<tbody>
<tr class="odd">
<td><p>[ibmuser@student ~]$ keytool -importcert -file cpd.pem -alias ibm.com -keystore cacerts -storepass changeit -noprompt</p>
<p>Certificate was added to keystore</p></td>
</tr>
</tbody>
</table>

<ol>
<li>Verify that the certificate has been imported</li>
</ol>
<blockquote>
<p>keytool -list -alias ibm.com -keystore cacerts -storepass changeit</p>
<p>The output is showing like this:</p>
</blockquote>
<table>
<tbody>
<tr class="odd">
<td><p>[ibmuser@student ~]$ keytool -list -alias ibm.com -keystore cacerts -storepass changeit</p>
<p>ibm.com, Mar 9, 2022, trustedCertEntry,</p>
<p>Certificate fingerprint (SHA1): AD:D6:9A:48:75:C8:99:5A:3F:67:8F:FA:92:7A:42:64:6B:DC:B8:6F</p></td>
</tr>
</tbody>
</table>

<ol>
<li>Copy the keystore file to Instana server</li>
</ol>
<blockquote>
<p>scp cacerts ibmadmin@instana:cacerts</p>
<p>When prompted, type <strong>yes</strong> and enter the <strong>ibmadmin</strong> user password
as: <strong>passw0rd</strong></p>
</blockquote>
<table>
<tbody>
<tr class="odd">
<td><p>[ibmuser@student ~]$ scp cacerts ibmadmin@instana:cacerts</p>
<p>The authenticity of host 'instana (10.0.0.2)' can't be established.</p>
<p>ECDSA key fingerprint is SHA256:2iiLhGeEpq7CO7VZxNezQp2jCabOWIBXWD+aevSHwYI.</p>
<p>Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</p>
<p>Warning: Permanently added 'instana,10.0.0.2' (ECDSA) to the list of known hosts.</p>
<p>ibmadmin@instana's password:</p>
<p>cacerts 100% 150KB 18.2MB/s 00:00</p></td>
</tr>
</tbody>
</table>

<ol>
<li>Access Instana server to adjust Instana settings to use the keystore
    certificate.</li>
</ol>
<blockquote>
<p>ssh ibmadmin@instana</p>
<p>When prompted, type <strong>yes</strong> and enter the <strong>ibmadmin</strong> user password
as: <strong>passw0rd</strong></p>
</blockquote>
<ol>
<li>Edit the <strong>settings.hcl</strong> file.</li>
</ol>
<blockquote>
<p>sudo vi settings.hcl</p>
<p>When prompted, enter the <strong>ibmadmin</strong> user password as: <strong>passw0rd</strong></p>
</blockquote>
<ol>
<li>Add the line <strong>custom_keystore="/home/ibmadmin/cacerts"</strong> to the
    beginning of the file and save the change.</li>
</ol>
<blockquote>
<p><img alt="Graphical user interface, text Description automatically
generated" src="../images/media/image30.png" /></p>
</blockquote>
<ol>
<li>Update Instana with the command.</li>
</ol>
<blockquote>
<p>sudo instana update -f /home/ibmadmin/settings.hcl</p>
<p>This will restart the Instana server and it will take a few minutes.</p>
</blockquote>
<table>
<tbody>
<tr class="odd">
<td><p>[ibmadmin@instana ~]$ sudo instana update -f /home/ibmadmin/settings.hcl</p>
<p>Setup host environment ✓</p>
<p>Handle certificates ✓</p>
<p>Ensure images ✓</p>
<p>Clean docker containers ✓</p>
<p>Check data directories ✓</p>
<p>Create configurations ✓</p>
<p>Migrate data stores ✓</p>
<p>Run components ✓</p>
<p>Check components ✓</p>
<p>Setup environment urls ✓</p>
<p>Run nginx ✓</p>
<p>Welcome to the World of Automatic Infrastructure and Application Monitoring</p></td>
</tr>
</tbody>
</table>

<ol>
<li>When the Instana server is updated, verify that the custom keystore
    has been enabled and end the ssh session</li>
</ol>
<blockquote>
<p>cat /var/log/instana/console.log | grep Keystore</p>
<p>exit</p>
</blockquote>
<table>
<tbody>
<tr class="odd">
<td><p>[ibmadmin@instana ~]$ cat /var/log/instana/console.log | grep Keystore</p>
<p>2022-03-07T10:09:41.269 INFO ▶ Custom Keystore is enabled: /home/ibmadmin/cacerts</p>
<p>….</p>
<p>[ibmadmin@instana ~]$ exit</p>
<p>logout</p>
<p>Connection to instana closed.</p></td>
</tr>
</tbody>
</table>

<ol>
<li>Create a SSH key on the OCP node and copy it over to all WAS
    instances</li>
</ol>
<blockquote>
<p>In order for WebSphere Automation to be able to collect data for you
WAS instances, you need to create a SSH key for their communications.</p>
<p>Note: To save time, this task is already completed for you in this lab
environment, so you do not need to do anything in this task. All the
task steps used in the lab environment are listed below for your
reference only.</p>
</blockquote>
<ol>
<li>Access the WebSphere Automation server to create a new SSH key.</li>
</ol>
<blockquote>
<p>ssh root@dns</p>
<p>When prompted, type <strong>yes</strong> and enter the <strong>root</strong> user password as:
<strong>passw0rd</strong></p>
</blockquote>
<ol>
<li>Issue command to create a new SSH key with passphrase. In the lab
    the passphrase used is: <strong>passw0rd</strong></li>
</ol>
<blockquote>
<p>ssh-keygen -f \~/.ssh/wsa</p>
</blockquote>
<p><img alt="Text, letter Description automatically
generated" src="../images/media/image31.png" /></p>
<ol>
<li>Copy the key over to the WAS server to be monitored. In this lab the
    following command is used:</li>
</ol>
<blockquote>
<p>ssh-copy-id -i \~/.ssh/wsa ibmuser@student.demo.ibmdte.net</p>
<p>When prompted, type <strong>yes</strong> and enter the <strong>ibmuser</strong> user password
as: <strong>engageibm!</strong></p>
</blockquote>
<ol>
<li>Test the login to the WAS server from the WebSphere Automation
    server via ssh key with the key passphrase.</li>
</ol>
<blockquote>
<p>ssh -i \~/.ssh/wsa <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#105;&#98;&#109;&#117;&#115;&#101;&#114;&#64;&#115;&#116;&#117;&#100;&#101;&#110;&#116;&#46;&#100;&#101;&#109;&#111;&#46;&#105;&#98;&#109;&#100;&#116;&#101;&#46;&#110;&#101;&#116;">&#105;&#98;&#109;&#117;&#115;&#101;&#114;&#64;&#115;&#116;&#117;&#100;&#101;&#110;&#116;&#46;&#100;&#101;&#109;&#111;&#46;&#105;&#98;&#109;&#100;&#116;&#101;&#46;&#110;&#101;&#116;</a></p>
<p>exit</p>
</blockquote>
<ol>
<li>Setting up WebSphere Automation for SSH to Linux or UNIX servers</li>
</ol>
<blockquote>
<p>KUBECONFIG=/root/install/auth/kubeconfig</p>
<p>oc project websphere-automation</p>
<p>oc create secret generic wsa-ansible \</p>
<p>--from-literal=ansible_user=ibmuser \</p>
<p>--from-literal=ansible_port=22 \</p>
<p>--from-file=ssh_private_key_file=/root/.ssh/wsa \</p>
<p>--from-literal=ssh_private_key_password=passw0rd</p>
<p>ssh-keyscan student.demo.ibmdte.net >> /root/wsa_known_hosts</p>
<p>oc create configmap wsa-ansible-known-hosts
--from-file=known_hosts=/root/wsa_known_hosts</p>
</blockquote>
<ol>
<li>Test connection</li>
</ol>
<blockquote>
<p>MANAGER_POD=$(oc get pod -l
app.kubernetes.io/component=runbook-manager -o name | head -n 1)</p>
<p>oc rsh $MANAGER_POD runcli testConnection student linux</p>
<p>The output is looking like:</p>
</blockquote>
<table>
<tbody>
<tr class="odd">
<td><p>[root@dns ~]# oc rsh $MANAGER_POD runcli testConnection student linux</p>
<p>Mar 09, 2022 6:46:06 PM com.ibm.ws.automation.core.runbook.manager.RunbookManagerCLI clientMode</p>
<p>INFO: starting</p>
<p>Created job: test-connection-1646851568775</p>
<p>To see the job logs run: oc logs --tail=100 -l job-name=test-connection-1646851568775</p></td>
</tr>
</tbody>
</table>

<ol>
<li>Exit the ssh session with command.</li>
</ol>
<blockquote>
<p>exit</p>
</blockquote>
<p><strong><br />
</strong></p>
<h1 id="part-4-configure-instana-for-memory-leak-alert"><strong>Part 4: Configure Instana for memory leak alert</strong></h1>
<p>This section describes the steps to configure Instana for the memory
leak alert to be used by WSA. The actives include creating a custom
payload, an alert channel, a custom event and an alert, which are done
using Instana administrative console.</p>
<ol>
<li>Create a custom payload.</li>
</ol>
<blockquote>
<p>You can create a custom payload by using the Instana administrative
console or using the Instana API, in the lab, you are using the
Instana administrative console.</p>
</blockquote>
<ol>
<li>From the Instana page, go to <strong>Settings</strong> > Team Settings page,
    under <strong>Events &amp; Alerts</strong>, click <strong>Custom Payload</strong>.</li>
</ol>
<blockquote>
<p><img alt="Graphical user interface, text, application, chat or text message
Description automatically generated" src="../images/media/image32.png" /></p>
</blockquote>
<ol>
<li>In the <strong>Key</strong> field, type <strong>PID</strong>, do not use any other value for
    the key. Set the <strong>Value type</strong> to <strong>Dynamic</strong>. In
    the <strong>Value</strong> field, click <strong>Select Tag</strong> and select <strong>Internal -
    Process ID</strong>, then click <strong>Save</strong>.</li>
</ol>
<blockquote>
<p><img alt="Graphical user interface, application Description automatically
generated" src="../images/media/image33.png" /></p>
</blockquote>
<ol>
<li>
<p>Gather the WSA information required to set up the Alert Channel.</p>
<ol>
<li>From the Terminal window, run the following <strong>oc</strong> commands to
    get the <strong>Webhook URL</strong> for WebSphere Automation installation.</li>
</ol>
</li>
</ol>
<blockquote>
<p>oc login --username=ibmadmin --password=engageibm
--insecure-skip-tls-verify=true
--server=https://api.demo.ibmdte.net:6443</p>
<p>oc project websphere-automation</p>
<p>oc get route cpd -o
jsonpath=https://{.spec.host}/websphereauto/health/webhooks/instana/memleak</p>
<p>Your outputs look like this</p>
</blockquote>
<table>
<tbody>
<tr class="odd">
<td><p>[ibmuser@student ~]$ oc login --username=ibmadmin --password=engageibm --insecure-skip-tls-verify=true --server=https://api.demo.ibmdte.net:6443</p>
<p>Login successful.</p>
<p>You have access to 66 projects, the list has been suppressed. You can list all projects with 'oc projects'</p>
<p>Using project "websphere-automation".</p>
<p>[ibmuser@student ~]$ oc project websphere-automation</p>
<p>Already on project "websphere-automation" on server "https://api.demo.ibmdte.net:6443".</p>
<p>[ibmuser@student ~]$ oc get route cpd -o jsonpath=https://{.spec.host}/websphereauto/health/webhooks/instana/memleak</p>
<p>https://cpd-websphere-automation.apps.demo.ibmdte.net/websphereauto/health/webhooks/instana/memleak</p></td>
</tr>
</tbody>
</table>

<blockquote>
<p>The WebSphere Automation Webhook URL is:
<strong>https://cpd-websphere-automation.apps.demo.ibmdte.net/websphereauto/health/webhooks/instana/memleak</strong>,
you will use it later.</p>
</blockquote>
<ol>
<li>Run the following oc command to get the token for WebSphere
    Automation installation.</li>
</ol>
<blockquote>
<p>oc serviceaccounts get-token wsa-health-webhooks-apis-sa</p>
<p>The output is shown below, you will use the token value later.</p>
</blockquote>
<table>
<tbody>
<tr class="odd">
<td><p>[ibmuser@student ~]$ oc serviceaccounts get-token wsa-health-webhooks-apis-sa</p>
<p>eyJhbGciOiJSUzI1NiIsImtpZCI6InJ1YTJ4VU1JdnRkemdlcFM1M0habGtTcXVuM1hlZlBrY19UUl82QWRWc0kifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJ3ZWJzcGhlcmUtYXV0b21hdGlvbiIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJ3c2EtaGVhbHRoLXdlYmhvb2tzLWFwaXMtc2EtdG9rZW4tc3R3bW4iLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoid3NhLWhlYWx0aC13ZWJob29rcy1hcGlzLXNhIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQudWlkIjoiMzcxNjBjZmYtMTUwNy00MWYyLWFlODgtYjg5MjcxZjJlNzlmIiwic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50OndlYnNwaGVyZS1hdXRvbWF0aW9uOndzYS1oZWFsdGgtd2ViaG9va3MtYXBpcy1zYSJ9.TVQfRO6E2ZTa4BBSvVgiv-74gbhEG-BVOBu0WaUFG_FBRJsplT6qr_trcsrvyNL9BVrF3kGd4oCqCos8HQGoIO0wEt7DsyePEbIRwL_vn8Jyr_qBr7cHrbWhu4y6EMWCObDWQdZRUsJqtgSLxtTzYqSf6upo_uQczjD5waWLX3gZbeeh5GcyNctFaQPpp_neM6HY-gZJxCSm8o7XmNB1Zcxg-F6ehhdf-0uXDXGYuBKsouWpBatERwBoVL3JgWQTPDUeIJApH9EOlO9LDieb8gaJDbWVB4b1ZsIWdlJg_F5pbWbapRuM8aAlf0HOxCaV84zTifK7J5R2NBf9xxeqrCqMpeSxfR5_Heh9WIl1lviKVn3qeS6aktj6duyu_5lpHw6RQjArcUk5NCxfe7hGS64BaISEbNdfrcYTNqEKeiNmydEuX7PpJaJxHBkmYYbWnZ0BrMaqQ1kUlTcvACs5FsNmbBQ3MOt3hin8dDqC9A1mFA_KlD1Oa1suhuY0DB_8tGwhKsIxFxY9pbKXhmqRl__7oueFxuFxxfvPWanL0WzRsoTJShyhcO6K3oyZPJWC4Cr2I42qo_g_Lth7gBIYRdzFJ63xpNgGUDStTXXcMkfMnm8v-lo5qzsezdgYBb6l152zcS6dA7Ld3502zIpnMx6ZGQadDL8uOSZbK-2CRU0</p></td>
</tr>
</tbody>
</table>

<ol>
<li>Create an alert channel.</li>
</ol>
<blockquote>
<p>To create an alert channel by using the Instana administrative
console,</p>
</blockquote>
<ol>
<li>On the Team Settings page, under <strong>Events &amp; Alerts</strong>, click <strong>Alert
    Channels</strong>.</li>
</ol>
<blockquote>
<p><img alt="Graphical user interface, application Description automatically
generated" src="../images/media/image34.png" /></p>
</blockquote>
<ol>
<li>Click <strong>Add Alert Channel</strong> and select <strong>Generic Webhook</strong>.</li>
</ol>
<blockquote>
<p><img alt="Graphical user interface, text, application Description
automatically generated" src="../images/media/image35.png" /></p>
</blockquote>
<ol>
<li>On the Create Generic Webhook Alert Channel page, enter a name of
    your choice in the <strong>Name</strong> field, in this lab the name is:</li>
</ol>
<blockquote>
<p>WebSphere Automation Healing Webhook</p>
</blockquote>
<ol>
<li>Enter the <strong>Webhook URL</strong> you have for WebSphere
    Automation installation.</li>
</ol>
<blockquote>
<p>https://cpd-websphere-automation.apps.demo.ibmdte.net/websphereauto/health/webhooks/instana/memleak</p>
<p><img alt="Graphical user interface, text, application, email, Teams
Description automatically generated" src="../images/media/image36.png" /></p>
</blockquote>
<ol>
<li>Under <strong>Custom HTTP Request Headers</strong>, click <strong>Add Header</strong>.</li>
</ol>
<p><img alt="Graphical user interface, text, application, email, website
Description automatically generated" src="../images/media/image37.png" /></p>
<ol>
<li>Create the following two request headers and then click <strong>Test
    Channel</strong>.</li>
</ol>
<table>
<thead>
<tr class="header">
<th><blockquote>
<p><strong>Key</strong></p>
</blockquote></th>
<th><strong>Value</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Content-Type</td>
<td>application/json</td>
</tr>
<tr class="even">
<td>Authorization</td>
<td>Token value you get with the oc command in previous step</td>
</tr>
</tbody>
</table>

<blockquote>
<p><img alt="Graphical user interface, text, application Description
automatically generated" src="../images/media/image38.png" /></p>
<p>you should see the message showing the channel was successfully
triggered.</p>
<p><img alt="Graphical user interface, text, application, email Description
automatically generated" src="../images/media/image39.png" /></p>
</blockquote>
<ol>
<li>After verifying the channel, click <strong>Create</strong> to create it.</li>
</ol>
<blockquote>
<p>The alert channel is created.</p>
<p><img alt="Graphical user interface, application Description automatically
generated" src="../images/media/image40.png" /></p>
</blockquote>
<ol>
<li>Create a custom event</li>
</ol>
<blockquote>
<p>To create a customer event by using the Instana administrative
console,</p>
</blockquote>
<ol>
<li>On the Team Settings page, under <strong>Events &amp; Alerts</strong>,
    click <strong>Events</strong>, then click <strong>New Event</strong>.</li>
</ol>
<blockquote>
<p><img alt="Graphical user interface, application Description automatically
generated" src="../images/media/image41.png" /></p>
</blockquote>
<ol>
<li>Create a custom “<strong>Memory Usage High</strong>” event and set its parameters
    as shown in the screenshot below and click <strong>Create</strong>:</li>
</ol>
<p><img alt="Graphical user interface, application Description automatically
generated" src="../images/media/image42.png" /></p>
<ol>
<li>Create an alert.</li>
</ol>
<blockquote>
<p>To create an alert by using the Instana administrative console,</p>
</blockquote>
<ol>
<li>On the Team Settings page, under <strong>Events &amp; Alerts</strong>,
    click <strong>Alerts</strong>, then click <strong>New Alert</strong>.</li>
</ol>
<blockquote>
<p><img alt="Graphical user interface, application, Teams Description
automatically generated" src="../images/media/image43.png" /></p>
</blockquote>
<ol>
<li>In the <strong>Name</strong> field, type a name for the alert as: <strong>WebSphere
    Automation Healing Memory Leak</strong>.</li>
</ol>
<blockquote>
<p><img alt="Graphical user interface, text, application, email Description
automatically generated" src="../images/media/image44.png" /></p>
</blockquote>
<ol>
<li>In the <strong>Events</strong> menu, select <strong>Alert on Event(s)</strong>.</li>
</ol>
<blockquote>
<p><img alt="Graphical user interface, application Description automatically
generated" src="../images/media/image45.png" /></p>
</blockquote>
<ol>
<li>In the <strong>Events</strong> section, click <strong>Add Event</strong>.</li>
</ol>
<blockquote>
<p><img alt="Graphical user interface, application Description automatically
generated" src="../images/media/image46.png" /></p>
</blockquote>
<ol>
<li>In the Add Events window, enter <strong>memory usage h</strong> in the search box
    and select <strong>Memory Usage High</strong>. You can filter the list by using a
    keyword (for example, leak) to help find the entry in the list.
    Click <strong>Add 1 Event</strong>.</li>
</ol>
<blockquote>
<p><img alt="Graphical user interface, application Description automatically
generated" src="../images/media/image47.png" /></p>
</blockquote>
<ol>
<li>Add two more events: <strong>Garbage collection activity high</strong> (for JVM)
    and <strong>Memory leak</strong> (for JVM).</li>
</ol>
<blockquote>
<p><img alt="Graphical user interface, text, application, email Description
automatically generated" src="../images/media/image48.png" /></p>
<p>The event list updated:</p>
<p><img alt="Graphical user interface, text, application Description
automatically generated" src="../images/media/image49.png" /></p>
</blockquote>
<ol>
<li>In the <strong>Scope</strong> menu, select <strong>All available entities</strong>.</li>
</ol>
<blockquote>
<p><img alt="Graphical user interface, application, Teams Description
automatically generated" src="../images/media/image50.png" /></p>
</blockquote>
<ol>
<li>Under <strong>Alerting</strong>, click <strong>Add Alert Channel</strong>, select the alert
    channel that you created previously, and click <strong>Add 1 Channel</strong>.</li>
</ol>
<blockquote>
<p><img alt="Graphical user interface, application Description automatically
generated" src="../images/media/image51.png" /></p>
<p><img alt="Graphical user interface, application Description automatically
generated" src="../images/media/image52.png" /></p>
</blockquote>
<ol>
<li>Click <strong>Create</strong>.</li>
</ol>
<blockquote>
<p><img alt="Graphical user interface, application, Teams Description
automatically generated" src="../images/media/image53.png" /></p>
<p>The alert is created.</p>
<p><img alt="Graphical user interface, application Description automatically
generated" src="../images/media/image54.png" /></p>
</blockquote>
<p>Now the Instana configuration for memory leak alert is completed<strong><br />
</strong></p>
<h1 id="part-5-websphere-memory-leak-check-with-websphere-automation"><strong>Part 5: WebSphere memory leak check with WebSphere Automation</strong></h1>
<p>In this section, you run a script to create memory leak incident for an
application running in a WebSphere Application server instance which is
already registered in WebSphere Automation. When WebSphere Automation
detects the memory leak, it automatically conducts the analysis to
identify the root cause.</p>
<ol>
<li>Start the WebSphere application server. From the Terminal window,
    run the command below to start the WebSphere application server:</li>
</ol>
<blockquote>
<p>/opt/IBM/WebSphere/AppServer9056/bin/startServer.sh tWAS_9056_server</p>
</blockquote>
<ol>
<li>Go back to WSA page in web browser and click <strong>Health</strong> icon.</li>
</ol>
<blockquote>
<p><img alt="Graphical user interface, application, Teams Description
automatically generated" src="../images/media/image55.png" /></p>
<p>Since all the application are working fine at this time, you do not
see anything in the Health page yet.</p>
<p><img alt="Graphical user interface, text, application Description
automatically generated" src="../images/media/image56.png" /></p>
</blockquote>
<ol>
<li>
<p>In this lab, you can also monitor the WebSphere application server
    memory change in Instana.</p>
<ol>
<li>In Instana page, click <strong>Infrastructure</strong> icon, click
    <strong>Comparison Table</strong> select <strong>JVMs</strong> from the dropdown and click
    <strong>bootstrap WAS90.SERV1.</strong></li>
</ol>
</li>
</ol>
<blockquote>
<p><img alt="Graphical user interface, application Description automatically
generated" src="../images/media/image57.png" /></p>
<p>As you can see, currently there is not any issue with the WAS server.</p>
</blockquote>
<p><img alt="Graphical user interface, text, application, email Description
automatically generated" src="../images/media/image58.png" /></p>
<ol>
<li>From the Terminal window, run the script to increase application
    heap usage which will create application memory leak event.</li>
</ol>
<blockquote>
<p>/home/ibmuser/WAS-Automation-LabFiles/lab2-MemoryLeak/curl_MLApp_add_was.sh</p>
</blockquote>
<p>The script output is showing like this:</p>
<table>
<tbody>
<tr class="odd">
<td><p>[ibmuser@student ~]$ /home/ibmuser/WAS-Automation-LabFiles/lab2-MemoryLeak/curl_MLApp_add_was.sh</p>
<p>Increased heap usage by 25MB</p>
<p>Increased heap usage by 50MB</p>
<p>Increased heap usage by 75MB</p>
<p>Increased heap usage by 100MB</p>
<p>Increased heap usage by 125MB</p>
<p>Increased heap usage by 150MB</p>
<p>Increased heap usage by 175MB</p>
<p>Increased heap usage by 200MB</p>
<p>Increased heap usage by 225MB</p>
<p>Increased heap usage by 250MB</p>
<p>Increased heap usage by 275MB</p>
<p>Increased heap usage by 300MB</p>
<p>Increased heap usage by 325MB</p></td>
</tr>
</tbody>
</table>

<ol>
<li>In the Instana page, you can see that one issue is detected.</li>
</ol>
<p><img alt="Graphical user interface, text, application Description automatically
generated" src="../images/media/image59.png" /></p>
<ol>
<li>Go back to WSA page, you see that WSA has received the Memory leak
    alert and activate its investigation on the issue. Initially you
    might see the Server Not identified yet status and soon you see the
    server name is identified. Click the <strong>Investigating</strong> link to view
    its details.</li>
</ol>
<p><img alt="Graphical user interface, application Description automatically
generated" src="../images/media/image60.png" /></p>
<p><img alt="Graphical user interface, text Description automatically
generated" src="../images/media/image61.png" /></p>
<ol>
<li>The Investigating section lists the problem, status, Server, Host
    and Cell information, why the investigation is started and the
    investigation history. Click the View history dropdown to see
    current investigation activities</li>
</ol>
<p><img alt="Graphical user interface, text, application Description automatically
generated" src="../images/media/image62.png" /></p>
<p>The WSA memory leak investigation activities include:</p>
<ul>
<li>
<p>Memory leak detected</p>
</li>
<li>
<p>Identifying server</p>
</li>
<li>
<p>Collecting heap dump</p>
</li>
<li>
<p>Analyzing heap dump</p>
</li>
<li>
<p>Investigation complete</p>
</li>
</ul>
<blockquote>
<p>The screenshot below shows that investigation is in process.,</p>
<p><img alt="Graphical user interface, application Description automatically
generated" src="../images/media/image63.png" /></p>
</blockquote>
<ol>
<li>If you check your email, you should have received a WSA notification
    like the following for the issue.</li>
</ol>
<blockquote>
<p><img alt="Graphical user interface, text, application, email Description
automatically generated" src="../images/media/image64.png" /></p>
</blockquote>
<ol>
<li>In a few minutes, the WSA investigation is completed, you can see
    the analysis summary which points to the root cause of the issue.
    You can also click <strong>Download all files</strong> to get the analysis
    reports, heap dumps and WSA runbooks on your workstation.</li>
</ol>
<p><img alt="Graphical user interface, text, application Description automatically
generated" src="../images/media/image65.png" /></p>
<blockquote>
<p><img alt="Graphical user interface, text, application Description
automatically generated" src="../images/media/image66.png" /></p>
<p><img alt="Graphical user interface, application Description automatically
generated" src="../images/media/image67.png" /></p>
<p><img alt="Graphical user interface, text, application, email Description
automatically generated" src="../images/media/image68.png" /></p>
</blockquote>
<ol>
<li>Now WSA has successfully detected and analyzed WAS memory leak
    issue, it has sent you another email to confirm that.</li>
</ol>
<blockquote>
<p><img alt="Graphical user interface, application Description automatically
generated" src="../images/media/image69.png" /></p>
</blockquote>
<ol>
<li>you can run a script to reduce the heap usage and then stop the WAS
    server with the commands:</li>
</ol>
<blockquote>
<p>/home/ibmuser/WAS-Automation-LabFiles/lab2-MemoryLeak/curl_MLApp_removeLast.sh</p>
<p>/opt/IBM/WebSphere/AppServer9056/bin/stopServer.sh tWAS_9056_server</p>
</blockquote>
<p><strong><br />
</strong></p>
<h1 id="part-6-liberty-memory-leak-check-with-websphere-automation"><strong>Part 6: Liberty memory leak check with WebSphere Automation</strong></h1>
<p>In this section, you are going to create a Liberty application memory
leak event and use WSA to detect and analyze the problem.</p>
<ol>
<li>Start the Liberty server with the command:</li>
</ol>
<blockquote>
<p>/opt/IBM/WebSphere/Liberty200012/bin/server start
Liberty_200012_server</p>
<p>The output is like this:</p>
</blockquote>
<table>
<tbody>
<tr class="odd">
<td><blockquote>
<p>[ibmuser@student ~]$ /opt/IBM/WebSphere/Liberty200012/bin/server start Liberty_200012_server</p>
<p>Starting server Liberty_200012_server.</p>
<p>Server Liberty_200012_server started with process ID 8439.</p>
</blockquote></td>
</tr>
</tbody>
</table>

<ol>
<li>Go back to Instana Infrastructure page, select <strong>Comparison Table</strong>
    > J<strong>VMs</strong> and click the <strong>Liberty_200012_server</strong> link.</li>
</ol>
<p><img alt="Graphical user interface, application Description automatically
generated" src="../images/media/image70.png" /></p>
<blockquote>
<p>You see the JVM dashboard displayed with No Issues status.</p>
</blockquote>
<p><img alt="Graphical user interface, application Description automatically
generated" src="../images/media/image71.png" /></p>
<ol>
<li>From the Terminal window, run the script to increase application
    heap usage which will create application memory leak event.</li>
</ol>
<p>/home/ibmuser/WAS-Automation-LabFiles/lab2-MemoryLeak/curl_MLApp_add_liberty.sh</p>
<p>The script output is showing like this:</p>
<table>
<tbody>
<tr class="odd">
<td><p>[ibmuser@student ~]$ /home/ibmuser/WAS-Automation-LabFiles/lab2-MemoryLeak/curl_MLApp_add_liberty.sh</p>
<p>Increased heap usage by 25MB</p>
<p>Increased heap usage by 50MB</p></td>
</tr>
</tbody>
</table>

<ol>
<li>In the Instana page, you can see that one issue is detected.</li>
</ol>
<p><img alt="Graphical user interface, application Description automatically
generated" src="../images/media/image72.png" /></p>
<ol>
<li>In the WSA Health page, you see another investigation is started for
    the Liberty server memory leak issue.</li>
</ol>
<p><img alt="Graphical user interface, application Description automatically
generated" src="../images/media/image73.png" /></p>
<blockquote>
<p>After a few minutes, the investigation is completed.</p>
</blockquote>
<p><img alt="Graphical user interface, text, application Description automatically
generated" src="../images/media/image74.png" /></p>
<blockquote>
<p>Since you are using the same application in both WAS and Liberty, you
should see the similar WSA Liberty memory leak analysis results as
WAS.</p>
<p><img alt="Graphical user interface, text, application, email Description
automatically generated" src="../images/media/image75.png" /></p>
</blockquote>
<p><span id="_Toc107577969" class="anchor"></span><strong>Summary</strong></p>
<p>Congratulations! You have completed the WebSphere Automation Memory
Leak Detection lab.</p>
<p>With automated tooling and insights, IBM WebSphere Automation enables
teams to modernize and secure IT estates, adapt and respond to incidents
efficiently, and optimize WebSphere operations. WebSphere system
operators and administrators can reduce the cost, effort, and risk of
addressing vulnerabilities, automate critical activities, and preserve
uptime with early detection, notification, and remediation of incidents.</p>
<p>IBM WebSphere Automation helps teams remove manual toil to work less on
maintenance tasks and more on strategic activities, while unlocking new
value, extending the life, and increasing ROI of WebSphere investments.</p>
<p>IBM WebSphere Automation is part of IBM Automation, a set of shared
automation services that help you get insight into how your processes
run, visualize hotspots and bottlenecks, and use financial impact
information to prioritize which issues to address first.</p>
<p>To learn more about IBM WebSphere Automation, visit
<a href="http://ibm.com/cloud/websphere-automation"><span class="underline">ibm.com/cloud/websphere-automation</span></a></p>
<h1 id="appendix-1-reserve-an-environment-for-the-lab"><strong>Appendix 1: Reserve an environment for the lab</strong></h1>
<table>
<tbody>
<tr class="odd">
<td><img src="./images/media/image76.png" style="width:0.60417in;height:0.60417in" alt="sign-caution" /></td>
<td><p><strong>IMPORTANT!</strong></p>
<p>Reserving an environment ONLY applies if you are performing this lab as self-paced outside of an instructor led virtual lab.</p>
<p>A Skytap cloud lab environment is required for performing the lab.</p>
<p>In <strong>self-paced mode</strong>, you are required to request an environment using the instructions provided below.</p>
<p>Otherwise, in an <strong>instructor led</strong> lab, the lab instructor will provide access to pre-provisioned lab environment.</p></td>
</tr>
</tbody>
</table>

<ol>
<li>Use the link below to access the WebSphere Foundation Bootcamp</li>
</ol>
<blockquote>
<p><a href="https://techzone.ibm.com/my/reservations/create/60da2c20e2cb7a001f656575">https://techzone.ibm.com/my/reservations/create/60da2c20e2cb7a001f656575</a></p>
</blockquote>
<ol>
<li>
<p>Use your <strong>IBM ID</strong> to login to the IBM Technology Zone</p>
</li>
<li>
<p>The <strong>Create a reservation</strong> page is displayed</p>
</li>
</ol>
<blockquote>
<p><img alt="" src="../images/media/image77.png" /></p>
</blockquote>
<ol>
<li>
<p>Select “<strong>Reserve for Now</strong>” Radio button, and then follow the
    on-screen dialog to reserve an environment in a Skytap data center
    in the closest Geography (US-Central, EMEA, Asia Pacific)</p>
<ol>
<li>
<p>The environment <strong>name</strong> should be pre-filled with “<strong>WebSphere
    Automation Environment – Skytap</strong>”</p>
</li>
<li>
<p><strong>Purpose</strong>: Practice / Self-Education</p>
</li>
<li>
<p><strong>Description</strong>: Enter a description. The field is required.</p>
</li>
<li>
<p><strong>End date and time</strong>: Use the calendar widget and select the
    maximum date available (2 weeks from date of reservation)</p>
</li>
<li>
<p><strong>Select a time</strong>: Select a time of day for reservation to
    expire</p>
</li>
<li>
<p>Select a <strong>timezone</strong> nearest to you</p>
</li>
</ol>
</li>
</ol>
<blockquote>
<p><img alt="" src="../images/media/image78.png" /></p>
</blockquote>
<ol>
<li>Preferred Geography: Choose a Skytap datacenter in the closest
    geography (US, EMEA, Asia Pacific)</li>
</ol>
<blockquote>
<p><img alt="" src="../images/media/image79.png" /></p>
</blockquote>
<ol>
<li>
<p>One complete, click on the “<strong>Submit</strong>” Button</p>
</li>
<li>
<p>The reservation takes a moment to be created. When it is created,
    click on the “<strong>My reservations</strong>” <img alt="" src="../images/media/image80.png" />
    button to see the detail so of the environment reservation.</p>
</li>
</ol>
<blockquote>
<p><strong>Note:</strong> The details of your environment reservation are displayed.</p>
</blockquote>
<ol>
<li>Take not of the <strong>Username</strong> and <strong>Password</strong>. Then click the
    <img alt="" src="../images/media/image81.png" /> icon to navigate to the Launch page.</li>
</ol>
<blockquote>
<p><img alt="" src="../images/media/image82.png" /></p>
</blockquote>
<ol>
<li>
<p>Click the “<strong>Open Your Skytap Environment</strong>” link.</p>
</li>
<li>
<p>Enter the <strong>Desktop Password</strong> for the VM access, that was generated
    for your environment. Click <strong>Submit</strong> button.</p>
</li>
</ol>
<blockquote>
<p><img alt="" src="../images/media/image83.png" /></p>
</blockquote>
<h3 id="the-lab-environment"><strong>The lab environment</strong></h3>
<p>Eight Linux VM has been provided for this lab.</p>
<p><img alt="" src="../images/media/image84.png" /></p>
<p>Note: The <strong>STUDENT</strong> VM is the VM you will login to and use in the lab.</p>
<p><img alt="" src="../images/media/image85.png" /></p>
<ul>
<li>The login credentials for the <strong>STUDENT”</strong> image is:</li>
</ul>
<blockquote>
<p>User ID: <strong>ibmuser</strong></p>
<p>Password: <strong>engageibm!</strong></p>
</blockquote>
              
            </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>

</body>
</html>
